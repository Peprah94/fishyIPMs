# set working directory.
#change this for your particular application
setwd("C:/GitHub/fishyIPMs")
# Load formatted data
load("dataset/formattedDataList.RData")
#load results
load("modelFitting/fittedModel.RData")
# set working directory.
#change this for your particular application
setwd("C:/GitHub/fishyIPMs")
# Load formatted data
load("dataset/formattedDataList.RData")
#load results
load("modelFitting/fittedModel.RData")
# Load required packages
library(nimble)
library(dplyr)
library(readr)
library(reshape2)
library(ggplot2)
grepl("lambda", rownames(fishModelMCMCrun$summary$all.chains))
# Extract population growth rate
interestedVars <- rownames(fishModelMCMCrun$summary$all.chains)[grepl("lambda", rownames(fishModelMCMCrun$summary$all.chains))]
interestedVars
fishModelMCMCrun$summary$all.chains[interestedVars, ]
dataList$ageAtHarvestData[, 1:3]
fishModelMCMCrun$summary$all.chains[interestedVars, ]%>%
cbind(., groupIndices)
groupIndices <- dataList$ageAtHarvestData[, 1:3]
fishModelMCMCrun$summary$all.chains[interestedVars, ]%>%
cbind(., groupIndices)
growthRate <- fishModelMCMCrun$summary$all.chains[interestedVars, ]%>%
cbind(., groupIndices)
# Let's see the variation of the population growth rate
growthRate%>%
ggplot(., aes(x = as.factor(yearGrowthOcc), y = Mean))+
geom_point(aes(color = lakeName))
# Let's see the variation of the population growth rate
growthRate%>%
ggplot(., aes(x = as.factor(yearGrowthOcc), y = Mean))+
geom_point(aes(color = lakeName))+
facet_wrap( ~sex)
# Let's see the variation of the population growth rate
growthRate%>%
ggplot(., aes(x = as.factor(yearGrowthOcc), y = Mean))+
geom_point(aes(color = lakeName))+
geom_line(aes(color = lakeName))+
facet_wrap( ~sex)
# Let's see the variation of the population growth rate
growthRate%>%
ggplot(., aes(x = as.factor(yearGrowthOcc), y = Mean))+
geom_point(aes(color = lakeName))+
geom_line()+
facet_wrap( ~sex)
# Let's see the variation of the population growth rate
growthRate%>%
ggplot(., aes(x = as.factor(yearGrowthOcc), y = Mean, color = lakeName))+
geom_point()+
geom_line()+
facet_wrap( ~sex)
#load packages
library(nimble)
library(dplyr)
library(readr)
library(reshape2)
# set working directory.
#change this for your particular application
setwd("C:/GitHub/fishyIPMs")
# catchment variables
catchmentVars <- read_csv("dataset/model_catchment_vars.csv")
colnames(catchmentVars)[2] <- "lakeID"
# Individual dataset
indData <- read_csv("dataset/Example2_vatnLnr.csv")
colnames(indData)[c(1:6,8:35)] <- c("lengthYrBefore",
"legthAtAgeThisYear",
"yearGrowthOcc",
"ageGrowthOcc",
"ageAtYr",
"fishID",
"climateZone",
"locationNumber",
"metersAboveSea",
"lineNumber",
"date",
"year",
"period",
"lakeName",
"lakeID",
"fishAge",
"fishLength",
"fishWeight",
"sex",
"maturationStage",
"maturation",
"ageAtGrowth",
"growth",
"instanteneousGrowth",
"capturePerUnitEffort",
"temperatureMeanInMay",
"temperatureMeanInJune",
"temperatureMeanInJuly",
"precipitationSumInMay",
"precipitationSumInJune",
"precipitationSumInJuly",
"temperatureMeanInSummer",
"precipitationSumDuringSummer",
"NAOwinterIndex")
indData <- indData[complete.cases(indData[, c("maturationStage", "maturation")]),] %>%
dplyr::mutate(maturationStage = as.numeric(maturationStage),
maturation = as.numeric(maturation),
presence = 1)
indData
ageAtHarvestData <- indDataWithCatchments[complete.cases(indDataWithCatchments[, c("ageAtYr", "sex")]),]%>%
dcast(.,
yearGrowthOcc + sex + lakeName ~ ageAtYr,
value.var = "presence",
fun.aggregate = sum)
colnames(indData)[c(1:6,8:35)] <- c("lengthYrBefore",
"legthAtAgeThisYear",
"yearGrowthOcc",
"ageGrowthOcc",
"ageAtYr",
"fishID",
"climateZone",
"locationNumber",
"metersAboveSea",
"lineNumber",
"date",
"year",
"period",
"lakeName",
"lakeID",
"fishAge",
"fishLength",
"fishWeight",
"sex",
"maturationStage",
"maturation",
"ageAtGrowth",
"growth",
"instanteneousGrowth",
"capturePerUnitEffort",
"temperatureMeanInMay",
"temperatureMeanInJune",
"temperatureMeanInJuly",
"precipitationSumInMay",
"precipitationSumInJune",
"precipitationSumInJuly",
"temperatureMeanInSummer",
"precipitationSumDuringSummer",
"NAOwinterIndex")
indData <- indData[complete.cases(indData[, c("maturationStage", "maturation")]),] %>%
dplyr::mutate(maturationStage = as.numeric(maturationStage),
maturation = as.numeric(maturation),
presence = 1)
indData
indDataWithCatchments <- indData %>%
right_join(catchmentVars, by = c("lakeID", "year"))%>%
dplyr::mutate(maturationStage = as.numeric(maturationStage),
maturation = as.numeric(maturation),
presence = 1)
unique(indDataWithCatchments$year)
unique(indData$year)
table(indDataWithCatchments$yearGrowthOcc, indDataWithCatchments$lakeName)
?dcast
dcast(indDataWithCatchments, formula = yearGrowthOcc + sex + lakeName ~ ageAtYr)
dcast(indDataWithCatchments, formula = yearGrowthOcc + sex + lakeName ~ ageAtYr,
value.var = "presence")
dcast(indDataWithCatchments, formula = yearGrowthOcc + sex + lakeName ~ ageAtYr,
value.var = "presence",
drop = FALSE)
dcast(indDataWithCatchments, formula = yearGrowthOcc + sex + lakeName ~ ageAtYr,
value.var = "presence",
drop = FALSE,
fill = NA)
dcast(indDataWithCatchments, formula = yearGrowthOcc + sex + lakeName ~ ageAtYr,
value.var = "presence",
#drop = FALSE,
fill = NA)
dcast(indDataWithCatchments, formula = yearGrowthOcc + sex + lakeName ~ ageAtYr,
value.var = "presence",
#drop = FALSE,
fill = 999)
dcast(indDataWithCatchments, formula = yearGrowthOcc + sex + lakeName ~ ageAtYr,
value.var = "presence",
#drop = FALSE,
fill = 0)
dcast(indDataWithCatchments, formula = yearGrowthOcc + sex + lakeName ~ ageAtYr,
value.var = "presence",
drop = FALSE,
fill = 0)
unique(indDataWithCatchments$yearGrowthOcc)
unique(indDataWithCatchments$sex)
unique(indDataWithCatchments$lakeName)
library(tidyr)
crossing(unique(indDataWithCatchments$yearGrowthOcc), unique(indDataWithCatchments$sex), unique(indDataWithCatchments$lakeName))
crossing(yearGrowthOcc = unique(indDataWithCatchments$yearGrowthOcc), sex = unique(indDataWithCatchments$sex), lakeName = unique(indDataWithCatchments$lakeName))
allGroups <- table(indDataWithCatchments$yearGrowthOcc, indDataWithCatchments$lakeName)
unique(indDataWithCatchments$yearGrowthOcc)
unique(indDataWithCatchments$yearGrowthOcc[!is.na(indDataWithCatchments$yearGrowthOcc)])
allGroups <- tidyr::crossing(yearGrowthOcc = unique(indDataWithCatchments$yearGrowthOcc[!is.na(indDataWithCatchments$yearGrowthOcc)]),
sex = unique(indDataWithCatchments$sex[!is.na(indDataWithCatchments$sex)]),
lakeName = unique(indDataWithCatchments$lakeName[!is.na(indDataWithCatchments$lakeName)]))
allGroups
# load Population data
popnData <- read_delim("dataset/Example1.csv",
delim = ";",
escape_double = FALSE,
trim_ws = TRUE)
colnames(popnData)[c(2:5,8,10,12,16:25,29:30)] <- c("climateZone",
"lakeNumber",
"lineNumber",
"date",
"lakeName",
"gillnetNumber",
"gillnetMeshSize",
"speciesName",
"fishLength",
"fishWeight",
"fishFat",
"gonadWeight",
"sex",
"maturationStage",
"maturation",
"revisedMaturation",
"stomachContent",
"otoliothRadius",
"captureAge")
# remove NAs from some selected columns
popnData <- popnData[complete.cases(popnData[, c("maturationStage", "maturation")]),] %>%
dplyr::mutate(maturationStage = as.numeric(maturationStage),
maturation = as.numeric(maturation))
# Explore the relationship
r <- c(popnData[, 22])$maturationStage
s <- c(popnData[, 23])$maturation
table(s,r) #what is the relationship between maturation and maturation stage?
# data is collected in 2008
# create the age at harvest data
ageAtHarvestData <- indDataWithCatchments[complete.cases(indDataWithCatchments[, c("ageAtYr", "sex", "lakeName")]),]%>%
dcast(.,
yearGrowthOcc + sex + lakeName ~ ageAtYr,
value.var = "presence",
fun.aggregate = sum)%>%
left_join(., indDataWithCatchments,
by = c("yearGrowthOcc", "sex", "lakeName"),
keep = FALSE,
multiple = "first")
indDataWithCatchments[complete.cases(indDataWithCatchments[, c("ageAtYr", "sex", "lakeName")]),]
allGroups <- tidyr::crossing(yearGrowthOcc = unique(indData$yearGrowthOcc[!is.na(indData$yearGrowthOcc)]),
sex = unique(indData$sex[!is.na(indData$sex)]),
lakeName = unique(indData$lakeName[!is.na(indData$lakeName)]))
# Merge indData and all groups
indData%>%
right_join(allGroups, by = c("yearGrowthOcc", "sex", "lakeName"))
# Merge indData and all groups
ttr <- indData%>%
right_join(allGroups, by = c("yearGrowthOcc", "sex", "lakeName"))
View(ttr)
indDataWithCatchments <- indData %>%
right_join(catchmentVars, by = c("lakeID", "year"))%>%
dplyr::mutate(maturationStage = as.numeric(maturationStage),
maturation = as.numeric(maturation),
presence = 1)
# Merge indData and all groups
indData <- indData%>%
right_join(allGroups, by = c("yearGrowthOcc", "sex", "lakeName"))
indDataWithCatchments <- indData %>%
right_join(catchmentVars, by = c("lakeID", "year"))%>%
dplyr::mutate(maturationStage = as.numeric(maturationStage),
maturation = as.numeric(maturation),
presence = 1)
View(indDataWithCatchments)
# set working directory.
#change this for your particular application
setwd("C:/GitHub/fishyIPMs")
# Load formatted data
load("dataset/formattedDataList.RData")
#load results
load("modelFitting/fittedModel.RData")
# Load required packages
library(nimble)
library(dplyr)
library(readr)
library(reshape2)
library(ggplot2)
groupIndices <- dataList$ageAtHarvestData[, 1:3]
# Extract population growth rate
interestedVars <- rownames(fishModelMCMCrun$summary$all.chains)[grepl("lambda", rownames(fishModelMCMCrun$summary$all.chains))]
growthRate <- fishModelMCMCrun$summary$all.chains[interestedVars, ]%>%
cbind(., groupIndices)
growthRate
allGroups <- tidyr::crossing(yearGrowthOcc = unique(indData$yearGrowthOcc[!is.na(indData$yearGrowthOcc)]),
sex = unique(indData$sex[!is.na(indData$sex)]),
lakeName = unique(indData$lakeName[!is.na(indData$lakeName)]))
indData <- dataList$indData
indData
allGroups <- tidyr::crossing(yearGrowthOcc = unique(indData$yearGrowthOcc[!is.na(indData$yearGrowthOcc)]),
sex = unique(indData$sex[!is.na(indData$sex)]),
lakeName = unique(indData$lakeName[!is.na(indData$lakeName)]))
allGroups
# Merge indData and all groups
indData <- growthRate%>%
right_join(allGroups, by = c("yearGrowthOcc", "sex", "lakeName"))
indData
# Merge indData and all groups
growthRate <- growthRate%>%
right_join(allGroups, by = c("yearGrowthOcc", "sex", "lakeName"))
# Let's see the variation of the population growth rate
growthRate%>%
ggplot(., aes(x = as.factor(yearGrowthOcc), y = Mean, color = lakeName))+
geom_point()+
geom_line()+
facet_wrap( ~sex)
?right_join
growthRate[is.na(growthRate)] <- 0
# Let's see the variation of the population growth rate
growthRate%>%
ggplot(., aes(x = as.factor(yearGrowthOcc), y = Mean, color = lakeName))+
geom_point()+
geom_line()+
facet_wrap( ~sex)
# Merge indData and all groups
growthRate <- growthRate%>%
right_join(allGroups, by = c("yearGrowthOcc", "sex", "lakeName"))
growthRate
View(growthRate)
growthRate%>%
ggplot(., aes(x = as.factor(yearGrowthOcc), y = Mean, color = as.factor(lakeName)))+
geom_point(aes(x = as.factor(yearGrowthOcc), y = Mean, color = as.factor(lakeName)))
View(allGroups)
?right_join
# Merge indData and all groups
growthRate <- growthRate%>%
right_join(allGroups,
by = c("yearGrowthOcc", "sex", "lakeName"),
keep = TRUE)
growthRate
growthRate <- fishModelMCMCrun$summary$all.chains[interestedVars, ]%>%
cbind(., groupIndices)
indData <- dataList$indData
allGroups <- tidyr::crossing(yearGrowthOcc = unique(indData$yearGrowthOcc[!is.na(indData$yearGrowthOcc)]),
sex = unique(indData$sex[!is.na(indData$sex)]),
lakeName = unique(indData$lakeName[!is.na(indData$lakeName)]))
# Merge indData and all groups
growthRate <- growthRate%>%
right_join(allGroups,
by = c("yearGrowthOcc", "sex", "lakeName"),
keep = TRUE)
growthRate[is.na(growthRate)] <- 0
# Let's see the variation of the population growth rate
growthRate%>%
ggplot(., aes(x = as.factor(yearGrowthOcc), y = Mean, color = as.factor(lakeName)))+
geom_point(aes(x = as.factor(yearGrowthOcc), y = Mean, color = as.factor(lakeName)))+
geom_line()+
facet_wrap( ~ sex)
growthRate
growthRate <- fishModelMCMCrun$summary$all.chains[interestedVars, ]%>%
cbind(., groupIndices)
indData <- dataList$indData
allGroups <- tidyr::crossing(yearGrowthOcc = unique(indData$yearGrowthOcc[!is.na(indData$yearGrowthOcc)]),
sex = unique(indData$sex[!is.na(indData$sex)]),
lakeName = unique(indData$lakeName[!is.na(indData$lakeName)]))
# Merge indData and all groups
growthRate <- growthRate%>%
full_join(allGroups,
by = c("yearGrowthOcc", "sex", "lakeName"))
growthRate
growthRate[is.na(growthRate)] <- 0
# Let's see the variation of the population growth rate
growthRate%>%
ggplot(., aes(x = as.factor(yearGrowthOcc), y = Mean, color = as.factor(lakeName)))+
geom_point(aes(x = as.factor(yearGrowthOcc), y = Mean, color = as.factor(lakeName)))+
geom_line()+
facet_wrap( ~ sex)
allGroups
growthRate%>%
ggplot(., aes(x = as.factor(yearGrowthOcc), y = Mean, color = as.factor(lakeName)))+
geom_point(aes(x = as.factor(yearGrowthOcc), y = Mean, color = as.factor(lakeName)))
?tidyr:crossing
?tidyr::crossing
allGroups <- tidyr::expand(yearGrowthOcc = unique(indData$yearGrowthOcc[!is.na(indData$yearGrowthOcc)]),
sex = unique(indData$sex[!is.na(indData$sex)]),
lakeName = unique(indData$lakeName[!is.na(indData$lakeName)]))
allGroups <- tidyr::expand(yearGrowthOcc = as.factor(unique(indData$yearGrowthOcc[!is.na(indData$yearGrowthOcc)])),
sex = as.factor(unique(indData$sex[!is.na(indData$sex)])),
lakeName = as.factor(unique(indData$lakeName[!is.na(indData$lakeName)])))
growthRate <- fishModelMCMCrun$summary$all.chains[interestedVars, ]%>%
cbind(., groupIndices)
growthRate%>%
expand(yearGrowthOcc, sex, lakeName)
growthRate%>%
tidyr::expand(yearGrowthOcc, sex, lakeName)
all <- growthRate%>%
tidyr::expand(yearGrowthOcc, sex, lakeName)
growthRate %>% right_join(all)
growthRate <- growthRate %>% right_join(all)
growthRate[is.na(growthRate)] <- 0
# Let's see the variation of the population growth rate
growthRate%>%
ggplot(., aes(x = as.factor(yearGrowthOcc), y = Mean, color = as.factor(lakeName)))+
geom_point(aes(x = as.factor(yearGrowthOcc), y = Mean, color = as.factor(lakeName)))+
geom_line()+
facet_wrap( ~ sex)
# Let's see the variation of the population growth rate
growthRate%>%
ggplot(., aes(x = as.factor(yearGrowthOcc), y = Mean, color = as.factor(lakeName)))+
geom_point(aes(x = as.factor(yearGrowthOcc), y = Mean, color = as.factor(lakeName)))+
#geom_line()+
facet_wrap( ~ sex)
# Let's see the variation of the population growth rate
growthRate%>%
ggplot(., aes(x = as.factor(yearGrowthOcc), y = Mean, group = as.factor(lakeName)))+
geom_point(aes(x = as.factor(yearGrowthOcc), y = Mean, color = as.factor(lakeName)))+
#geom_line()+
facet_wrap( ~ sex)
# Let's see the variation of the population growth rate
growthRate%>%
ggplot(., aes(x = as.factor(yearGrowthOcc), y = Mean, group = as.factor(lakeName)))+
geom_point(aes(x = as.factor(yearGrowthOcc), y = Mean, color = as.factor(lakeName)))+
geom_line()+
facet_wrap( ~ sex)
# Let's see the variation of the population growth rate
growthRate%>%
ggplot(., aes(x = as.factor(yearGrowthOcc), y = Mean, group = as.factor(sex)))+
geom_point(aes(x = as.factor(yearGrowthOcc), y = Mean, color = as.factor(sex)))+
geom_line()+
facet_wrap( ~ as.factor(lakeName))
# Let's see the variation of the population growth rate
growthRate%>%
ggplot(., aes(x = as.factor(yearGrowthOcc), y = Mean, group = as.factor(sex)))+
geom_point(aes(x = as.factor(yearGrowthOcc), y = Mean, color = as.factor(sex)))+
geom_line()+
facet_wrap( ~ as.factor(lakeName))+
theme_classic()
# Let's see the variation of the population growth rate
growthRate%>%
ggplot(., aes(x = as.factor(yearGrowthOcc), y = Mean, group = as.factor(sex)))+
geom_point(aes(x = as.factor(yearGrowthOcc), y = Mean, color = as.factor(sex)))+
geom_line()+
geom_ribbon(aes(ymin = `95%CI_low`, ymax = `95%CI_upp`))+
facet_wrap( ~ as.factor(lakeName))+
theme_classic()
# Let's see the variation of the population growth rate
growthRate%>%
ggplot(., aes(x = as.factor(yearGrowthOcc), y = Mean, group = as.factor(sex)))+
geom_point(aes(x = as.factor(yearGrowthOcc), y = Mean, color = as.factor(sex)))+
geom_line()+
geom_ribbon(aes(ymin = `95%CI_low`, ymax = `95%CI_upp`, alpha = 0.1))+
facet_wrap( ~ as.factor(lakeName))+
theme_classic()
# Let's see the variation of the population growth rate
growthRate%>%
ggplot(., aes(x = as.factor(yearGrowthOcc), y = Mean, group = as.factor(sex)))+
geom_point(aes(x = as.factor(yearGrowthOcc), y = Mean, color = as.factor(sex)))+
geom_line()+
geom_ribbon(aes(ymin = `95%CI_low`, ymax = `95%CI_upp`, color = as.factor(sex)), alpha = 0.1)+
facet_wrap( ~ as.factor(lakeName))+
theme_classic()
# Let's see the variation of the population growth rate
growthRate%>%
ggplot(., aes(x = as.factor(yearGrowthOcc), y = Mean, group = as.factor(sex)))+
geom_point(aes(x = as.factor(yearGrowthOcc), y = Mean, color = as.factor(sex)))+
geom_line()+
geom_ribbon(aes(ymin = `95%CI_low`, ymax = `95%CI_upp`, fill = as.factor(sex)), alpha = 0.1)+
facet_wrap( ~ as.factor(lakeName))+
theme_classic()
# Let's see the variation of the population growth rate
growthRate%>%
ggplot(., aes(x = as.factor(yearGrowthOcc), y = Mean, group = as.factor(sex)))+
geom_point(aes(x = as.factor(yearGrowthOcc), y = Mean, color = as.factor(sex)))+
geom_line()+
geom_ribbon(aes(ymin = `95%CI_low`, ymax = `95%CI_upp`, fill = as.factor(sex)), alpha = 0.2)+
facet_wrap( ~ as.factor(lakeName))+
theme_classic()
# Let's see the variation of the population growth rate
growthRate%>%
ggplot(., aes(x = as.factor(yearGrowthOcc), y = Mean, group = as.factor(sex)))+
geom_point(aes(x = as.factor(yearGrowthOcc), y = Mean, color = as.factor(sex)))+
geom_line()+
geom_ribbon(aes(ymin = `95%CI_low`, ymax = `95%CI_upp`, fill = as.factor(sex)), alpha = 0.2)+
facet_wrap( ~ as.factor(lakeName))+
theme_classic()+
+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
# Let's see the variation of the population growth rate
growthRate%>%
ggplot(., aes(x = as.factor(yearGrowthOcc), y = Mean, group = as.factor(sex)))+
geom_point(aes(x = as.factor(yearGrowthOcc), y = Mean, color = as.factor(sex)))+
geom_line()+
geom_ribbon(aes(ymin = `95%CI_low`, ymax = `95%CI_upp`, fill = as.factor(sex)), alpha = 0.2)+
facet_wrap( ~ as.factor(lakeName))+
theme_classic()+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
# Let's see the variation of the population growth rate
growthRate%>%
ggplot(., aes(x = as.factor(yearGrowthOcc), y = Mean, group = as.factor(sex)))+
geom_point(aes(x = as.factor(yearGrowthOcc), y = Mean, color = as.factor(sex)))+
geom_line()+
geom_ribbon(aes(ymin = `95%CI_low`, ymax = `95%CI_upp`, fill = as.factor(sex)), alpha = 0.2)+
facet_wrap( ~ as.factor(lakeName))+
theme_classic()+
theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1))
# Let's see the variation of the population growth rate
growthRate%>%
ggplot(., aes(x = as.factor(yearGrowthOcc), y = Mean, group = as.factor(sex)))+
geom_point(aes(x = as.factor(yearGrowthOcc), y = Mean, color = as.factor(sex)))+
geom_line()+
geom_ribbon(aes(ymin = `95%CI_low`, ymax = `95%CI_upp`, fill = as.factor(sex)), alpha = 0.2)+
facet_wrap( ~ as.factor(lakeName))+
theme_classic()+
theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1))+
ylab("Population Growth Rate")+
xlab("Year Growth Occured")
